import{r as e,f as t,j as s,H as n}from"./react-core-BZS_6Arc.js";import{S as o}from"./vendor-DViQF3d3.js";import i from"./BuilderHeader-BWYhS5mn.js";import r from"./BuilderSidebar-ycM_-dxV.js";import a from"./BuilderCanvas-Cq397OKl.js";import c from"./InspectorPanel-w0GH68YA.js";import{s as l}from"./sectionRegistry-1byhU7Yk.js";import"./SortableSectionItem-DkNza8Np.js";import"./SectionPreview-A1kIxqd-.js";import"./ErrorBoundary-VvKZrXxs.js";import"./RepeaterEditor-BIWFPFyI.js";import"./ServiceCtaSection-Dd-EsAQi.js";import"./NewsSection-CjWC3kLL.js";import"./whatsapp-Df9uErmj.js";import"./ui-swiper-Db3Ms2SX.js";import"./SectionTitle-DGQnDq9T.js";import"./image-Bpv4Ue0F.js";import"./VisionMissionSection-HFuRWtN7.js";function u({page:u,sections:p,allServices:d,allProjects:f}){const{state:m,set:v,undo:S,redo:g,canUndo:y,canRedo:j}=function(t,s=50){const[n,o]=e.useState({past:[],present:t,future:[]}),i=n.past.length>0,r=n.future.length>0,a=e.useCallback(()=>{o(e=>{if(0===e.past.length)return e;const t=e.past[e.past.length-1];return{past:e.past.slice(0,-1),present:t,future:[e.present,...e.future]}})},[]),c=e.useCallback(()=>{o(e=>{if(0===e.future.length)return e;const t=e.future[0],s=e.future.slice(1);return{past:[...e.past,e.present],present:t,future:s}})},[]),l=e.useCallback(e=>{o(t=>{const n="function"==typeof e?e(t.present):e;if(JSON.stringify(n)===JSON.stringify(t.present))return t;const o=[...t.past,t.present];return o.length>s&&o.shift(),{past:o,present:n,future:[]}})},[s]);return{state:n.present,set:l,undo:a,redo:c,canUndo:i,canRedo:r,historyState:n}}(p||[],50),[h,w]=e.useState(null),[x,k]=e.useState(!1),[C,b]=e.useState(!0),[B,E]=e.useState(!0),[K,N]=e.useState("desktop"),R=m.find(e=>e.id===h)||null;e.useEffect(()=>{h&&E(!0)},[h]);const D=e=>{const t=e.map((e,t)=>({...e,position:t}));v(t)},P=e.useCallback(()=>{k(!0),t.post("/admin/page-builder/".concat(u.id,"/save"),{sections:m.map((e,t)=>({id:String(e.id).startsWith("new-")?null:e.id,section_key:e.section_key,config:JSON.stringify(e.config||{}),position:t,is_active:e.is_active}))},{preserveScroll:!0,onSuccess:()=>{k(!1),o.fire({toast:!0,position:"top-end",icon:"success",title:"Page saved successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})},onError:e=>{k(!1),o.fire({toast:!0,position:"top-end",icon:"error",title:"Failed to save page",showConfirmButton:!1,timer:3e3})}})},[u.id,m]);return e.useEffect(()=>{const e=e=>{(e.metaKey||e.ctrlKey)&&"s"===e.key&&(e.preventDefault(),P()),!e.metaKey&&!e.ctrlKey||"z"!==e.key||e.shiftKey||(e.preventDefault(),y&&S()),(e.metaKey||e.ctrlKey)&&("z"===e.key&&e.shiftKey||"y"===e.key)&&(e.preventDefault(),j&&g()),"Escape"===e.key&&w(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[P,S,g,y,j]),s.jsxs("div",{className:"h-screen flex flex-col bg-gray-100 font-sans overflow-hidden",children:[s.jsx(n,{title:"Builder: ".concat(u.title)}),s.jsx("div",{className:"flex-none z-50",children:s.jsx(i,{page:u,onSave:P,isSaving:x,previewDevice:K,setPreviewDevice:N,onUndo:S,onRedo:g,canUndo:y,canRedo:j})}),s.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[s.jsx(r,{sections:m,onReorder:D,onSelect:w,selectedSectionId:h,onAddSection:e=>{const t=l[e];if(!t)return;const s={id:"new-".concat(Date.now()),section_key:e,config:t.defaultConfig||{},position:m.length,is_active:!0},n=[...m,s];v(n),w(s.id)},onRemove:e=>{confirm("Are you sure you want to remove this section? This action will be saved when you click 'Save Changes'.")&&(v(t=>t.filter(t=>t.id!==e)),h===e&&w(null))},isOpen:C,onToggle:()=>b(!C)}),s.jsx("main",{className:"flex-1 bg-gray-100/50 relative overflow-hidden flex flex-col",children:s.jsx(a,{sections:m,selectedSectionId:h,onSelectSection:w,onMoveSection:D,previewDevice:K,allServices:d,allProjects:f})}),s.jsx(c,{section:R,onUpdate:e=>{v(m.map(t=>t.id===e.id?e:t))},isOpen:B,onToggle:()=>E(!B),onClose:()=>w(null)})]})]})}export{u as default};
