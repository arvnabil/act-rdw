import{r as i,b as N,j as a,H as P}from"./app-8jlO-GOR.js";import{S as R}from"./sweetalert2.esm.all-BQxta0Da.js";import U from"./BuilderHeader-Be5vFg-F.js";import H from"./BuilderSidebar-D4IDO2vs.js";import I from"./BuilderCanvas-BhcD-gq_.js";import z from"./InspectorPanel-DYfH_aKq.js";import{s as A}from"./sectionRegistry-64G4vYmK.js";/* empty css            */import"./sortable.esm-ENtqbFO9.js";import"./SortableSectionItem-CXm16cly.js";import"./SectionPreview-Q5im1JP8.js";import"./ErrorBoundary-C09O_Zxy.js";import"./RepeaterEditor-CkFLpNA8.js";import"./NewsSection-UHrrHHR6.js";import"./NewsSection-VcruIdJg.js";import"./effect-fade-Cql-zif5.js";import"./SectionTitle-DHTxUSIO.js";import"./ClientSection-bHLo9NX-.js";import"./VisionMissionSection-DsSs9BhA.js";function L(l,y=50){const[c,u]=i.useState({past:[],present:l,future:[]}),r=c.past.length>0,d=c.future.length>0,p=i.useCallback(()=>{u(s=>{if(s.past.length===0)return s;const o=s.past[s.past.length-1];return{past:s.past.slice(0,-1),present:o,future:[s.present,...s.future]}})},[]),m=i.useCallback(()=>{u(s=>{if(s.future.length===0)return s;const o=s.future[0],n=s.future.slice(1);return{past:[...s.past,s.present],present:o,future:n}})},[]),v=i.useCallback(s=>{u(o=>{const n=typeof s=="function"?s(o.present):s;if(JSON.stringify(n)===JSON.stringify(o.present))return o;const h=[...o.past,o.present];return h.length>y&&h.shift(),{past:h,present:n,future:[]}})},[y]);return{state:c.present,set:v,undo:p,redo:m,canUndo:r,canRedo:d,historyState:c}}function re({page:l,sections:y,allServices:c,allProjects:u}){const{state:r,set:d,undo:p,redo:m,canUndo:v,canRedo:s}=L(y||[],50),[o,n]=i.useState(null),[h,g]=i.useState(!1),[x,K]=i.useState(!0),[k,b]=i.useState(!0),[j,B]=i.useState("desktop"),E=r.find(t=>t.id===o)||null;i.useEffect(()=>{o&&b(!0)},[o]);const O=t=>{const e=A[t];if(!e)return;const f={id:`new-${Date.now()}`,section_key:t,config:e.defaultConfig||{},position:r.length,is_active:!0},S=[...r,f];d(S),n(f.id)},D=t=>{d(r.map(e=>e.id===t.id?t:e))},C=t=>{const e=t.map((f,S)=>({...f,position:S}));d(e)},_=t=>{confirm("Are you sure you want to remove this section? This action will be saved when you click 'Save Changes'.")&&(d(e=>e.filter(f=>f.id!==t)),o===t&&n(null))},w=i.useCallback(()=>{g(!0),N.post(`/admin/page-builder/${l.id}/save`,{sections:r.map((t,e)=>({id:String(t.id).startsWith("new-")?null:t.id,section_key:t.section_key,config:t.config,position:e,is_active:t.is_active}))},{preserveScroll:!0,onSuccess:()=>{g(!1),R.fire({toast:!0,position:"top-end",icon:"success",title:"Page saved successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})},onError:t=>{g(!1),console.error(t),R.fire({toast:!0,position:"top-end",icon:"error",title:"Failed to save page",showConfirmButton:!1,timer:3e3})}})},[l.id,r]);return i.useEffect(()=>{const t=e=>{(e.metaKey||e.ctrlKey)&&e.key==="s"&&(e.preventDefault(),w()),(e.metaKey||e.ctrlKey)&&e.key==="z"&&!e.shiftKey&&(e.preventDefault(),v&&p()),(e.metaKey||e.ctrlKey)&&(e.key==="z"&&e.shiftKey||e.key==="y")&&(e.preventDefault(),s&&m()),e.key==="Escape"&&n(null)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[w,p,m,v,s]),a.jsxs("div",{className:"h-screen flex flex-col bg-gray-100 font-sans overflow-hidden",children:[a.jsx(P,{title:`Builder: ${l.title}`}),a.jsx("div",{className:"flex-none z-50",children:a.jsx(U,{page:l,onSave:w,isSaving:h,previewDevice:j,setPreviewDevice:B,onUndo:p,onRedo:m,canUndo:v,canRedo:s})}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx(H,{sections:r,onReorder:C,onSelect:n,selectedSectionId:o,onAddSection:O,onRemove:_,isOpen:x,onToggle:()=>K(!x)}),a.jsx("main",{className:"flex-1 bg-gray-100/50 relative overflow-hidden flex flex-col",children:a.jsx(I,{sections:r,selectedSectionId:o,onSelectSection:n,onMoveSection:C,previewDevice:j,allServices:c,allProjects:u})}),a.jsx(z,{section:E,onUpdate:D,isOpen:k,onToggle:()=>b(!k),onClose:()=>n(null)})]})]})}export{re as default};
